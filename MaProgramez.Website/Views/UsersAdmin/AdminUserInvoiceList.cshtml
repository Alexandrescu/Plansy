@using MaProgramez.Resources
@using MvcPaging
@using MaProgramez.Repository.Entities
@model IPagedList<MaProgramez.Website.ViewModels.InvoiceListItemViewModel>

@{
    ViewBag.Title = Resource.InvoicesList;
    string userId = ViewBag.UserId;
    var sortBy = ViewBag.SortBy as string;
    var ascending = (bool)ViewBag.Ascending;
    var filterBy = ViewBag.FilterBy as string;

    var culture = new System.Globalization.CultureInfo("en-US");
}

<div class="clear"></div>

<div class="panel panel-default">
    <div class="panel-body">
        <h4>@Resource.InvoicesList - @ViewBag.Name</h4>

        @using (Html.BeginForm())
        {
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <input type="search" name="filterBy" class="form-control input-sm" placeholder="@Resource.Search" value="@filterBy" />
                    </div>
                </div>
            </div>

            <input type="submit" style="display: none;" />
        }

        @if (Model != null && Model.Any())
        {
            <div class="sablon">
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminUserInvoiceList(null, userId, "number", filterBy, sortBy != "number" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "number", ascending)"></i> @Resource.InvoiceNumber</a></th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminUserInvoiceList(null, userId, "name", filterBy, sortBy != "name" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "name", ascending)"></i> @Resource.User_Name</a></th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminUserInvoiceList(null, userId, "date", filterBy, sortBy != "date" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "date", ascending)"></i> @Resource.InvoiceDate</a></th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminUserInvoiceList(null, userId, "duedate", filterBy, sortBy != "duedate" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "duedate", ascending)"></i> @Resource.InvoiceDueDate</a></th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminUserInvoiceList(null, userId, "amountwithoutvat", filterBy, sortBy != "amountwithoutvat" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "amountwithoutvat", ascending)"></i> @Resource.InvoiceAmountWithoutVat</a></th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminUserInvoiceList(null, userId, "amountincludingvat", filterBy, sortBy != "amountincludingvat" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "amountincludingvat", ascending)"></i> @Resource.InvoiceAmountIncludingVat</a></th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminUserInvoiceList(null, userId, "invoicestate", filterBy, sortBy != "invoicestate" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "invoicestate", ascending)"></i> @Resource.InvoiceStateTitle</a></th>

                        </tr>
                    </thead>
                    <tbody>
                        @{
                            var number = (ViewBag.Page * Model.PageSize) + 1;
                        }

                        @foreach (var invoice in Model)
                        {
                            <tr>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Invoice.InvoicePdf(invoice.Id))">@(number++)</td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Invoice.InvoicePdf(invoice.Id))">@invoice.Number</td>
                                @if (invoice.FirstName.IsEmpty() && invoice.LastName.IsEmpty())
                                {
                                    <td class="clickable-row" data-href="@Url.Action(MVC.Invoice.InvoicePdf(invoice.Id))">
                                        @invoice.UserName
                                    </td>
                                }
                                else
                                {
                                    <td class="clickable-row" data-href="@Url.Action(MVC.Invoice.InvoicePdf(invoice.Id))">
                                        @invoice.FirstName
                                        &nbsp;
                                        @invoice.LastName
                                    </td>
                                }

                                @{var state = invoice.State == InvoiceState.Open ? "-" : invoice.PaymentState;}

                                <td class="clickable-row" data-href="@Url.Action(MVC.Invoice.InvoicePdf(invoice.Id))">@invoice.Date.ToString("dd-MM-yyyy")</td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Invoice.InvoicePdf(invoice.Id))">@invoice.DueDate.ToString("dd-MM-yyyy")</td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Invoice.InvoicePdf(invoice.Id))">@invoice.AmountWithoutVat.ToString("N2", culture)</td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Invoice.InvoicePdf(invoice.Id))">@invoice.AmountWithVat.ToString("N2", culture)</td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Invoice.InvoicePdf(invoice.Id))">@state</td>
                            </tr>
                                    }
                    </tbody>
                </table>
                </div>
                if ((Model.TotalItemCount) > Model.PageSize)
                {
                @Html.Pager(Model.PageSize, Model.PageNumber, Model.TotalItemCount).Options(o => o
                    .DisplayTemplate("Bootstrap3Pagination")
                    .MaxNrOfPages(14)
                    .AlwaysAddFirstPageNumber()
                    .AddRouteValue("sortBy", sortBy)
                    .AddRouteValue("ascending", ascending)
                    .AddRouteValue("filterBy", filterBy)
                    )
                }
                }
                else
                {
                <p>@Resource.NoInvoices</p>
                }

            </div>
    @Html.ActionLink(@Resource.Back, "Index", "UsersAdmin", new { @class = "btn btn-link float-left" })

</div>