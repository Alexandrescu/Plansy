@using MaProgramez.Resources
@using MaProgramez.Website.Helpers
@using MvcPaging
@using MaProgramez.Repository.Entities
@model MvcPaging.IPagedList<InvoicePayment>


@{
    ViewBag.Title = Resource.Payments;
    string userId = ViewBag.UserId;
    var sortBy = ViewBag.SortBy as string;
    var ascending = (bool)ViewBag.Ascending;
    var filterBy = ViewBag.FilterBy as string;
}

<div class="clear"></div>

<div class="panel panel-default">
    <div class="panel-body">
        <h4>@Resource.Payments - @ViewBag.Name</h4>

        @using (Html.BeginForm())
        {
            <div class="row">
                <div class="col-md-4">
                    <div class="form-group">
                        <input type="search" name="filterBy" class="form-control input-sm" placeholder="@Resource.Search" value="@filterBy" />
                    </div>
                </div>
            </div>

            <input type="submit" style="display: none;" />
        }

        @if (Model != null && Model.Any())
        {
            <div class="sablon">
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminInvoicePaymentsList(null, userId, "title", filterBy, sortBy != "title" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "title", ascending)"></i> @Resource.Description</a></th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminInvoicePaymentsList(null, userId, "amount", filterBy, sortBy != "amount" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "amount", ascending)"></i> @Resource.Invoice_PaymentAmount</a></th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminInvoicePaymentsList(null, userId, "method", filterBy, sortBy != "method" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "method", ascending)"></i> @Resource.PaymentMethod</a></th>
                            <th><a href="@Url.Action(MVC.UsersAdmin.AdminInvoicePaymentsList(null, userId, "date", filterBy, sortBy != "date" || !ascending))"><i class="fa @MaProgramez.Website.Helpers.TableHelper.GetTableHeaderIcon(sortBy, "date", ascending)"></i> @Resource.Date</a></th>

                        </tr>
                    </thead>
                    <tbody>
                        @{
            var number = (ViewBag.Page * Model.PageSize) + 1;
                        }

                        @foreach (var payment in Model)
                    {
                    <tr>
                        <td class="clickable-row" data-href="@Url.Action(MVC.UsersAdmin.Index())">@(number++)</td>
                        <td class="clickable-row" data-href="@Url.Action(MVC.UsersAdmin.Index())">@payment.InvoiceHeader.InvoiceLines[0].LineDescription</td>
                        <td class="clickable-row" data-href="@Url.Action(MVC.UsersAdmin.Index())">@payment.Amount</td>
                        <td class="clickable-row" data-href="@Url.Action(MVC.UsersAdmin.Index())">@payment.PaymentMethod.DisplayDescription()</td>
                        <td class="clickable-row" data-href="@Url.Action(MVC.UsersAdmin.Index())">@payment.Date.ToString("dd-MM-yyyy")</td>

                    </tr>
                    }
                    </tbody>
                </table></div>
                if ((Model.TotalItemCount) > Model.PageSize)
                {
                @Html.Pager(Model.PageSize, Model.PageNumber, Model.TotalItemCount).Options(o => o
                    .DisplayTemplate("Bootstrap3Pagination")
                    .MaxNrOfPages(14)
                    .AlwaysAddFirstPageNumber()
                    .AddRouteValue("sortBy", sortBy)
                    .AddRouteValue("ascending", ascending)
                    .AddRouteValue("filterBy", filterBy)
                    )
                }
                }
                else
                {
                <p>@Resource.NoPayments</p>
                }

            </div>
    @Html.ActionLink(@Resource.Back, "Index", "UsersAdmin", new { @class = "btn btn-link float-left" })
</div>