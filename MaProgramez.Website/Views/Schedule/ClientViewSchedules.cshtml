@using System
@using DayPilot.Web.Mvc
@using DayPilot.Web.Mvc.Enums
@using DayPilot.Web.Mvc.Enums.Calendar
@using MaProgramez.Repository.BusinessLogic
@using MaProgramez.Repository.Entities
@using Microsoft.AspNet.Identity
@model  List<MaProgramez.Repository.Entities.Schedule>

@{
    ViewBag.Title = Resource.MySchedules;
    var date = (DateTime)ViewBag.Date;
}

<script src="/scripts/daypilot-all.min.js" type="text/javascript"></script>

<section class="filtre">

    <div class="container">
        <div class="col-lg-3 schedule">
           <h4> @Resource.MySchedules </h4>
        </div><!-- /.col-lg-3 -->
        <div class="col-lg-3 schedule">
            (@date.ToShortDateString() - @date.AddDays(6).ToShortDateString())
        </div><!-- /.col-lg-3 -->
        <div class="col-lg-4 sch float-right">
            <a class="btn btn-primary btn-lg buton5" href="@Url.Action(MVC.Schedule.ClientViewSchedules(date.AddDays(-7)))" role="button">@Resource.PreviousDays</a>
            <a class="btn btn-primary btn-lg buton5" href="@Url.Action(MVC.Schedule.ClientViewSchedules(date.AddDays(7)))" role="button">@Resource.NextDays</a>
        </div><!-- /.col-lg-3 -->
    </div>
</section>
<div class="up-toticket">
    &nbsp;
</div>
<section class="sectiune-cat stilizat-cat">

    <div class="container stilizat " style="height:800px;">
        @if (Model != null && Model.Any())
        {
            <div class="row rond">
                <div class="col-lg-1">
                    <h3 class="cap">@Resource.Date</h3>
                </div>
                <div class="col-lg-2">
                    <h3 class="cap">@Resource.Provider</h3>
                </div>
                <div class="col-lg-2">
                    <h3 class="cap">@Resource.User_Address</h3>
                </div>
                <div class="col-lg-4">
                    <h3 class="cap">@Resource.Operations</h3>
                </div>
                <div class="col-lg-1">
                    <h3 class="cap">@Resource.State</h3>
                </div>
                <div class="col-lg-2">
                    <h3 class="cap">@Resource.Details</h3>
                </div>

                @foreach (var item in Model)
                {
                    <div class="col-lg-1">
                        <p class="corp" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">@item.ScheduleDateTimeStart.ToString("dd/MM/yyyy HH:mm")</p>
                    </div>
                    <div class="col-lg-2">
                        @if (item.Slot.Provider.ProgrammingPerSlot)
                    {
                            <p class="corp" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">
                                @item.Slot.Provider.CompanyDisplayName - @item.Slot.Name
                            </p>
                        }
                        else
                        {
                            <p class="corp" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">
                                @item.Slot.Provider.CompanyDisplayName
                            </p>
                        }
                    </div>
                    <div class="col-lg-2">
                        <p class="corp" href=@string.Concat("http://maps.google.com/?q=", item.Slot.Provider.GetWorkLocationAddress().ToLinkString())
                           target="blank">
                            @item.Slot.Provider.GetWorkLocationAddress().ToString()
                        </p>
                    </div>
                    <div class="col-lg-4">
                        @foreach (var m in RetrieveLists.GetOperationsBySchedule(item.Id))
                        {
                            <p class="corp">
                                <i>@m.Operation.Description</i> <span style="font-weight:normal">&nbsp;(€@m.Price&nbsp; -&nbsp;
                                <i class="glyphicon glyphicon-time"></i> &nbsp;@m.DurationMinutes&nbsp; min.)</span>
                            </p>
                        }

                    </div>
                    <div class="col-lg-1">

                        <p class="corp" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">
                            @switch (item.State)
                            {
                                case ScheduleState.Pending:
                                    <span class="font-warning">@Resource.Pending</span>
                                    break;
                                case ScheduleState.CancelledByProvider:
                                    <span class="font-danger">@Resource.CancelledByProvider</span>
                                    break;
                                case ScheduleState.CancelledByUser:
                                    <span class="font-danger">@Resource.CancelledByUser</span>
                                    break;
                                default:
                                    <span class="font-success">@Resource.Valid</span>
                                    break;
                            }
                        </p>
                    </div>
                    <div class="col-lg-2">
                        <p class="corp" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">
                            @item.Text
                        </p>
                    </div>
                    <div class="clear"></div>
                }


            </div>}
        <div class="row rond" style="height:700px; margin-top:50px;">

            @Html.DayPilotCalendar("dpcClient", new DayPilotCalendarConfig
       {
           StartDate = date.Date,
           BackendUrl = Url.Action(MVC.Schedule.BackendClient(User.Identity.GetUserId())),
           EventClickHandling = DayPilot.Web.Mvc.Events.Calendar.EventClickHandlingType.CallBack,
           ViewType = DayPilot.Web.Mvc.Enums.Calendar.ViewType.Days,
           HeightSpec = HeightSpec.BusinessHours,
           WeekStarts = WeekStarts.Monday,
           Days = 7,
           BusinessBeginsHour = 7,
           BusinessEndsHour = 20,
       })

            <div class="clear"></div>
            <div class="col-md-12">
                <div class="well well-sm" style="margin-top: 20px">
                    <p style="margin-bottom:0; font-style: italic">
                        @Resource.ViewSchedules_InfoClient!
                    </p>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </div>
</section>
