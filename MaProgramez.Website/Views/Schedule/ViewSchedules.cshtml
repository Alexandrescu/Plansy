@using System
@using DayPilot.Web.Mvc
@using DayPilot.Web.Mvc.Enums
@using DayPilot.Web.Mvc.Enums.Calendar
@using MaProgramez.Repository.BusinessLogic
@using MaProgramez.Repository.Entities
@model List<Schedule>

@{
    ViewBag.Title = Resource.MySchedules;
    var date = (DateTime)ViewBag.Date;
    var id = (int)ViewBag.SlotId;
}


<script src="/scripts/daypilot-all.min.js" type="text/javascript"></script>


<section class="filtre">

    <div class="container">
        @if (User.IsInRole("Provider"))
            {

            <div class="col-lg-4 schedule">
                <h4>@Resource.MySchedules - @ViewBag.SlotName</h4>
            </div>
        }
        else
        {
            <div class="col-lg-4 schedule">
                <h4>@Resource.MySchedules</h4>
            </div>
        }

        <div class="col-lg-3 schedule">
            <h4>(@date.ToShortDateString() - @date.AddDays(6).ToShortDateString())</h4>
        </div><!-- /.col-lg-3 -->
        <div class="col-lg-5 sch float-right" style="margin-right: -70px">
            <a class="btn btn-primary btn-lg buton5long" href="@Url.Action(MVC.Schedule.ViewPendingSchedules(id))" role="button">@Resource.PendingSchedules</a>
            <a class="btn btn-primary btn-lg buton5" href="@Url.Action(MVC.Schedule.ViewSchedules(id, date.AddDays(-7)))" role="button">@Resource.PreviousDays</a>
            <a class="btn btn-primary btn-lg buton5" href="@Url.Action(MVC.Schedule.ViewSchedules(id, date.AddDays(7)))" role="button">@Resource.NextDays</a>
            <!--<a href=@Url.Action(MVC.Schedule.ViewPendingSchedules(id)) data-toggle="tooltip" title="Vezi programarile ce asteapta confirmare" style="float: right; padding-right: 15px"><i class="glyphicon glyphicon-calendar font-warning"></i></a>-->
        </div><!-- /.col-lg-3 -->

    </div>
</section>
<div class="up-toticket">
    &nbsp;
</div>
<section class="sectiune-cat stilizat-cat">
    <div class="container stilizat">

        @if (Model.Any())
        {
            <div class="sablon" style="margin-left: -35px;">
                <table class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>@Resource.ScheduleDate</th>
                            <th>@Resource.User_Name</th>
                            <th>@Resource.PhoneNumber</th>
                            <th>@Resource.Operations</th>
                            <th>@Resource.ScheduleState</th>
                            <th>@Resource.Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">@item.ScheduleDateTimeStart.ToString("dd/MM/yyyy HH:mm")</td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">@item.User.FirstName @item.User.LastName</td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">@item.User.PhoneNumber</td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">
                                    @foreach (var m in RetrieveLists.GetOperationsBySchedule(item.Id))
                                    {
                                        <div>
                                            <i>@m.Operation.Description</i> <span>&nbsp;(&nbsp;<i class="fa fa-money"></i>&nbsp;@m.Price&nbsp;RON -&nbsp;<i class="glyphicon glyphicon-time"></i> &nbsp;@m.DurationMinutes&nbsp; min.)</span>
                                        </div>
                                    }
                                </td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">
                                    @switch (item.State)
                                    {
                                        case ScheduleState.Pending:
                                            <span class="font-warning">@Resource.Pending</span>
                                            break;
                                        case ScheduleState.CancelledByProvider:
                                            <span class="font-danger">@Resource.CancelledByProvider</span>
                                            break;
                                        case ScheduleState.CancelledByUser:
                                            <span class="font-danger">@Resource.CancelledByUser</span>
                                            break;
                                        default:
                                            <span class="font-success">@Resource.Valid</span>
                                            break;
                                    }
                                </td>
                                <td class="clickable-row" data-href="@Url.Action(MVC.Schedule.ViewSchedule(item.Id))">
                                    @item.Text
                                </td>

                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        @if (Model.Any())
        {
            <div class="clear"></div>

            <div class="divider"></div>
                    <br />
        }
        <br />

        <div class="col-md-12">
            @Html.DayPilotCalendar("dpc", new DayPilotCalendarConfig
       {
           StartDate = date.Date,
           BackendUrl = Url.Action(MVC.Schedule.Backend(id)),
           //EventMoveHandling = DayPilot.Web.Mvc.Events.Calendar.EventMoveHandlingType.CallBack,
           //EventResizeHandling = DayPilot.Web.Mvc.Events.Calendar.EventResizeHandlingType.JavaScript,
           EventClickHandling = DayPilot.Web.Mvc.Events.Calendar.EventClickHandlingType.CallBack,
           TimeRangeSelectedHandling = DayPilot.Web.Mvc.Events.Calendar.TimeRangeSelectedHandlingType.CallBack,
           ViewType = DayPilot.Web.Mvc.Enums.Calendar.ViewType.Days,
           HeightSpec = HeightSpec.BusinessHours,
           WeekStarts = WeekStarts.Monday,
           Days = 7
       })
        </div><div class="clear"></div>
        <div class="col-md-12">
            <div class="well well-sm" style="margin-top: 20px">
                <p style="margin-bottom:0; font-weight:bold;" class="font-normal">
                    @Resource.ViewSchedules_Info1;
                </p>
                <p style="margin-bottom:0; font-weight:bold;" class="font-warning">
                    @Resource.ViewSchedules_Info2.
                </p>

            </div>
        </div>
        <div class="clear"></div>

    </div>
</section>